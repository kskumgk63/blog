---
title: "Learning Test Driven Disign"
date: 2020-04-30T20:33:56+09:00
draft: true

categories: ["development"]
tags: []
author: ""
---

# テスト駆動開発から学んだこと

- コードを書く前に、失敗するコードを必ず書く
- 重複を除去する

## TDDのリズム

「動作するきれいなコード」を目指す。
これは、偉大なプログラマでも難しい。普通のプログラマならなおさら。
なので、テストを書いてたくさん失敗してコードを磨き続けよう。

1. まずはテストを最初に書く
2. すべてのテストを走らせて、新しいテストの失敗を確認する
3. 小さな変更を加える
4. すべてのテストを実行して、すべて成功することを確認する
5. リファクタリングを行って重複を除去する

## メモ　なぐり書き

テストから始めるということは、完璧なインターフェイスでないとだめだ。（関数の定義がしっかりしていないとだめ）
言い換えれば、細かい実装は置いておき、設計から整えるということ。

Value Object パターン
VOは生まれてから死ぬまで値は変わらない。
なぜなら5千円はずっと5千円で7千円になったら別のオブジェクトにならねばならない。

コピーアンドペーストは抽象化の敗北。

## テストをいつ書くか

テスト対象の実装前。プログラマの仕事は機能を実装することなので実装を終えるとテストは忘れられるだろう。

## TDDを身につける

### 一歩の大きさはどのくらいか
- 各々のテストがどのくらいカバーするべきか
- リファクタリングの過程で中継地点をどのくらい作るか

自信を持って行うためにテストテストを書くのだ。ロジックに1行追加したり、10行くらい変更してもテストが書かれていれば自信をもって前に進める。
デバッグがすぐに行える。正しいふるまいがブレずに明確にあるからだ。

リファクタリングを行う際には、ステップをたくさんの小さなステップに分割することを心がける。小さな小さなリファクタリングを20回手作業でやってみて、振り返ったときにステップをいくつか飛ばせるか実験する。

### やる必要のないテストはあるのか

「不安が退屈になる」というのが１つの指標になる。ただしユニットテストの実装は自分が書いたコードに限る。

### 良いテストを見分けることができるか

テスト設計から立ち上る悪臭を敏感に察知して教えてくれる。炭鉱のカナリアだ。
設計に問題を抱えている場合、テストには以下のような兆候が現れる。

#### 前準備に要するコードが長い
アサーションを行うテスト対象オブジェクトの準備に100行のコードが必要なのであれば、何かがおかしい。
そのオブジェクトは大きすぎるので分割するほうが良い。

#### 前準備コードの重複
共通の前準備コードを配置する場所がすぐに見つからな良いのは、お互いに密に関連しあうオブジェクトが多すぎることを示唆している。

#### テスト実行時間が長い
TDDにおいては、テスト実行がかかりすぎると実行の頻度は低くなる。
長い実行時間は、アプリケーションのいち部を切り出したテストが難しいことを示唆している。
部分的なテストが難しいのは設計の問題であるため。設計の観点から取り組まなければならない。

#### 脆いテスト
思わぬタイミングで失敗するテストは、アプリケーションのどこかが意外な形で他の部分に影響している可能背を示唆している。
2つの部分の関係性を経つか、または統合するなどして、離れた箇所から影響を控除するように設計し直さなければならない。

## どのようなときにテストを消すべきか
テストの数は多いに越したことがないが、もし2つのテストの間に重複が発生した場合、2つとも残すべきか？？

- テストを削除して自信が減るのなら決して削除してはならない
- 2つのテストが読み手に異なるシナリオに見えるなら消さずにそのままにしておこう
